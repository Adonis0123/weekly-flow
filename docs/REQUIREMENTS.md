# Weekly Flow 需求规格说明书

## 1. 项目概述

### 1.1 项目背景

作为开发者，每周需要编写工作周报来汇报进度。手动整理 Git 提交记录费时费力，且容易遗漏重要工作内容。Weekly Flow 旨在自动化这一流程，通过分析 Git 提交历史，智能生成结构化的周报内容。

### 1.2 项目目标

开发一个 Claude Code Skill，实现以下核心目标：

- **自动化**：自动读取 Git 提交记录，减少手动整理工作
- **智能化**：过滤琐碎提交，提炼关键工作内容
- **标准化**：按统一格式输出，保持周报风格一致
- **便捷性**：一键生成，支持多仓库汇总

### 1.3 目标用户

- 需要定期编写周报的开发者
- 使用 Claude Code 的技术团队
- 希望提高周报编写效率的个人

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 Git 提交分析

| 功能点 | 描述 | 优先级 |
|-------|------|-------|
| 读取提交记录 | 获取指定时间范围内的所有 commit | P0 |
| 用户识别 | 自动识别当前用户 (`git config user.name`) | P0 |
| 多分支支持 | 读取用户在所有分支上的提交（建议 `git log --all`，并确保已 fetch 到相关远端分支） | P0 |
| 多仓库汇总 | 支持配置多个仓库，统一生成周报 | P1 |

#### 2.1.2 智能过滤

自动过滤以下类型的提交：

- 纯格式化/代码风格调整
- 简单的 typo 修复
- 依赖版本小幅更新
- Merge commit
- 重复性的相似提交

#### 2.1.3 周报生成

- 按项目分组展示
- 层级结构：主要工作点 → 补充说明 → 详细内容
- 主要工作点控制在 10 字以内（最长不超过 20 字）
- 相关联的改动自动合并

#### 2.1.4 补充内容

- 支持用户添加文字补充（会议、讨论、非代码工作等）
- 补充内容归类到「其他」分类

### 2.2 时间范围选择

#### 周报时间范围

| 选项 | 描述 |
|-----|------|
| 本周 | 自动计算本周一至今天 |
| 上周 | 自动计算上周一至上周日 |
| 自定义周报 | 用户输入周一日期，自动推算周日 |

#### 时间段报告时间范围

| 选项 | 描述 |
|-----|------|
| 前半年 | 自动计算最近 6 个月的日期范围（从今天往前推 6 个自然月） |
| 自定义时间段 | 用户输入任意起始日期，截止时间为今天 |

**约束条件**：
- 周报时间范围必须以周一为起点，周日为终点
- 时间段报告允许任意日期作为起始日期
- 结束日期不能超过当前日期

### 2.3 存储管理

#### 2.3.1 周报存储

- 存储位置：`~/.weekly-reports/`
- 文件命名：`{year}/week-{week}.md`（如 `2024/week-02.md`）
- 支持追加更新：同一周多次生成时智能合并

#### 2.3.2 时间段报告存储

- 存储位置：`~/.weekly-reports/periods/`
- 文件命名：`{start_date}_to_{end_date}.md`（如 `2025-07-13_to_2026-01-13.md`）
- 支持追加更新：同一时间段多次生成时智能合并

#### 2.3.3 配置存储

配置文件：`~/.weekly-reports/config.json`

```json
{
  "repos": [
    {
      "name": "project-name",
      "path": "/absolute/path/to/project"
    }
  ],
  "default_author": "auto",
  "output_format": "markdown"
}
```

## 3. 技术架构

### 3.1 模块设计

```
src/
├── __init__.py          # 模块初始化，版本信息
├── date_utils.py        # 日期处理工具
│   ├── get_week_range()           # 获取周的起止日期
│   ├── get_half_year_range()      # 获取前半年的日期范围
│   ├── validate_date_range()      # 验证周报日期范围
│   ├── validate_custom_date_range() # 验证自定义日期范围
│   ├── get_available_time_ranges()  # 获取可选时间范围列表
│   └── format_date_for_filename()   # 生成文件名日期格式
├── git_analyzer.py      # Git 分析器
│   ├── get_commits()    # 获取提交记录
│   ├── get_user_name()  # 获取当前用户
│   └── filter_commits() # 过滤琐碎提交
├── report_generator.py  # 周报生成器
│   ├── generate()       # 生成周报内容
│   ├── group_by_project()
│   └── format_output()
├── config_manager.py    # 配置管理
│   ├── load_config()
│   ├── save_config()
│   └── add_repo()
└── storage.py           # 存储管理
    ├── save_report()           # 保存周报
    ├── save_period_report()    # 保存时间段报告
    ├── get_report_path()       # 获取周报路径
    ├── get_period_report_path() # 获取时间段报告路径
    └── list_period_reports()   # 列出时间段报告
```

### 3.2 依赖项

| 依赖 | 版本 | 用途 |
|-----|------|------|
| Python | >=3.9 | 运行环境 |
| Jinja2 | >=3.0.0 | 模板渲染 |
| Git | - | 提交记录读取 |

### 3.3 Claude Code Skill 集成

Skill 配置文件 (`SKILL.md`) 定义：

- **名称**：`weekly-report`
- **触发命令**：`/weekly-report`
- **允许的工具**：`Read`, `Write`, `Bash(git:*)`, `Bash(python:*)`

## 4. 用户交互流程

```
┌─────────────────────────────────────────────────────────┐
│                    /weekly-report                        │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│  1. 选择时间范围                                          │
│     ○ 本周 (推荐)                                        │
│     ○ 上周                                               │
│     ○ 前半年                                             │
│     ○ 自定义周报                                          │
│     ○ 自定义时间段                                        │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│  2. 选择仓库 (多选)                                       │
│     ☑ project-a                                         │
│     ☑ project-b                                         │
│     ☐ project-c                                         │
│     [+ 添加当前目录]                                      │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│  3. 补充内容 (可选)                                       │
│     输入额外工作内容，如会议、讨论等                        │
│     留空则跳过                                            │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│  4. 生成报告                                              │
│     - 读取 Git 提交                                       │
│     - 过滤 & 分组                                         │
│     - 生成 Markdown                                      │
│     - 周报保存到 ~/.weekly-reports/{year}/               │
│     - 时间段报告保存到 ~/.weekly-reports/periods/         │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│  5. 输出结果                                              │
│     显示生成的报告内容                                     │
│     显示保存路径                                          │
└─────────────────────────────────────────────────────────┘
```

## 5. 输出格式规范

### 5.1 格式结构

```markdown
项目名称
  - 主要工作点（10字以内）
    - 补充说明（可选）
      - 更详细内容（可选）

其他
  - 非项目相关工作
```

### 5.2 示例输出

```markdown
project-a
  - turbopack 升级改造
  - Agent 开发流程跟进
    - 方案合理性优化
    - 问题边界定义
  - 油猴脚本国际化优化

project-b
  - 自定义类型化消息渲染
  - 断线重连流程梳理

其他
  - 新版国际化方案讨论
  - 技术分享会议
```

详细格式规范见 [周报格式规范](../references/WEEKLY_REPORT_FORMAT.md)

## 6. 安装部署

### 6.1 安装方式

| 方式 | 适用场景 | 命令 |
|-----|---------|------|
| 一键安装 | 个人使用 | `./install.sh` |
| 手动安装 | 自定义配置 | 复制到 `~/.claude/skills/` |
| 项目级安装 | 团队共享 | 复制到 `.claude/skills/` |

### 6.2 系统要求

- Claude Code CLI 已安装
- Git 已安装并配置用户信息
- Python >= 3.9

## 7. 后续规划

### 7.1 待实现功能

- [ ] 支持图片输入（截图识别 commit）
- [ ] 周报模板自定义
- [ ] 导出为其他格式（HTML、PDF）
- [ ] 历史周报查看与搜索
- [ ] 周报统计分析（工作量趋势）

### 7.2 优化方向

- [ ] 提交信息智能分类准确度提升
- [ ] 大型仓库性能优化
- [ ] 更智能的提交合并算法

## 8. 变更记录

| 版本 | 日期 | 变更内容 |
|-----|------|---------|
| 1.1.0 | 2026-01 | 新增时间段报告功能：前半年总结、自定义时间段报告 |
| 1.0.0 | 2024-01 | 初始版本，完成核心功能 |
